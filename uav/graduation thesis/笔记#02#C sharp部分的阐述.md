[TOC]

## GCS的C#部分开发思路

### 1 一些基础知识

首先要会打开VS

然后需要会创建一个Solution

创建一个桌面程序。

这里阐述一下包管理工具啥的使用。

### 2 这里开始OOP启动！

我是采取一个面向对象的开发思想。

将一启动程序就启动的那个窗体类称作Entrance

一经启动就会同时开启一个web socket后台服务器

考虑到程序的可扩展性。既可以在该后台软件的基础上设计一个C#前端。所以我保留以下代码，通过简单修改就可以用：这里放辣个代码

我个人实现的是一个浏览器前端。所以在创建Entrance类对象的同时，创建了一个web socket后台服务器类对象。顾名思义，该类抽象表示一个web socket服务器。默认的什么来着为ws://127.0.0.1:8080

经过我的封装（有兴趣可以打开看 其实就两行代码），假设我有一个该类的对象server。那么我可以通过server.sendMessage向所有与该服务器通信的浏览器端发送实时的web socket协议消息。

然后我采取叫做啥的工具，将MavLink消息对象，直接转化为JSON格式便于前端进行解析并处理。

发浏览器这个操作，要强调是一个创新。



辣么下面开始进入主要部分

随着 E类对象的创建，同时也创建了一个GCS4MAVLink类对象，我用该类来抽象代表一个无人机地面站。这里保留了未来多无人机的可能性。倘若服务有多个无人机。那么创建多个该类对象就可以了。至于多无人机数据的可视化显示 。同样只需要创建多个web socket服务器。通过不同的地址端口 ，开启多个网页，就可以了。牛逼！



那么GCS4MAVLink类对象做了什么事情呢。

该类对象提供了 一个startup方法， 我们只需要传入相应的 端口号和波特率就可以 去连接一个 无人机飞控。

以及我们必须传入一个 消息处理器，对来自无人机 的数据进行响应。

GCS4MAVLink类对象一旦创建，并调用startup方法就会按x频率 向飞控发送 心跳包以及请求数据包。

倘若需要扩展更多的数据交互方法，扩展此类即可。具体方法可以参考MP的开源代码simple example



GCS4MAVLink类对象具体怎样和垃个飞控交互，又是借助一个飞控类对象。该类用于抽象表示飞控，实际上是一个SerialPort对象的代理人。但是我们在程序里把它视为飞控就可以了。特别的方法只有GetPacket以及ReceiveBytes，前者用于从飞控读取一个MAVLink包（解析字节码过程由MAVLink包完成了）。后者用于向飞控发送字节流。只需要把创建好的MAVLink消息字节作为参数传递进去即可。



一个总共只有4个自定义类的简易无人机后台就搭建好了。

接下来进入前端部分。













